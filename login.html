<!DOCTYPE html>
<html>
	<head>
		<!--Import Google Icon Font-->
		<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

		<!--Import materialize.css-->
		<link type="text/css" rel="stylesheet" href="css/materialize.min.css"	media="screen,projection"/>

		<!--Import style.css-->
		<link type="text/css" rel="stylesheet" href="css/style.css"/>

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<title>START! | Login</title>

		<!--Import jQuery before materialize.js-->
		<script src="js/jquery.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/materialize.min.js"></script>
	</head>

	<body>
		<!--Top navigation bar-->
		<nav>
			<div class="nav-wrapper black">
				<a href="index.html" class="brand-logo"> START! </a>
				<ul id="nav-mobile" class="right"> <!-- The navigation links are aligned to the right -->
					<li><a href="signup.html"> Sign Up </a></li>
					<li><a href="login.html"> Login </a></li>
				</ul>
			</div>
		</nav>

		<!-- Login form -->
		<br>
		<div class="container">
			<div class="row">
				<div class="card-panel col s12 m6 grey lighten-4 center offset-m3">
					<form class="col s12 m6 offset-m3">
						<h5>Log In</h5>

						<!-- Email -->
						<div class="row">
							<div class="input-field col s12">
								<i class="material-icons prefix">email</i>
								<input id="email" type="email" class="validate">
								<label data-error="Please enter a valid email address"> <b>Email</b> </label>
							</div>
						</div>

						<!-- Password -->
						<div class="row">
							<div class="input-field col s12">
								<i class="material-icons prefix">vpn_key</i>
								<input id="password" type="password" class="validate">
								<label> <b>Password</b> </label>
							</div>
						</div>

						<!-- Submit button -->
						<a class="waves-effect waves-light btn" id="login" style="margin-bottom: 20px;"><i class="material-icons right">send</i><b>Login</b></a>
					</form>
					<br>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			$(document).ready(function(){
				$("#login").click(function(){
					if ($('#email').val() != "" && $('#password').val() != ""){
						var jsonObject = {
							"action": "LOGIN",
							"email": $('#email').val(),
							"password": $('#password').val()
						};
						
						$.ajax({
							type:'POST',
							url:'data/applicationLayer.php',
							data: jsonObject,
							dataType:'json',
							headers:{'Content-Type':'application/x-www-form-urlencoded'},
							success: function(jsonData){
								//logged = true;
		                        //checkUserStatus();
		                        // Send the user to the profile page
								window.location.replace("profile.html");
								alert(jsonData.message);
							},
							error:function(errorMessage){
								alert("Error trying to login!");
							}
						});  
					} else {
						alert("Complete all fields!");
					}
				});

				// Login
				$("#loginButton").click(function(){
	                var jsonData = {
	                    "email" : $("#emailLogin").val(),
	                    "password" : $("#passwordLogin").val(),
	                    "cookie" : $("#cookieCheckbox").is(":checked"),
	                    "action" : "LOGIN"
	                };

	                $.ajax({
						url : "data/applicationLayer.php",
						type: "POST",
						data: jsonData,
						dataType : "json",
						contentType : "application/x-www-form-urlencoded",
						success: function(jsonResponse){
							$("#userForm").hide(400);
							$("#infoMessage").html("<h2>" + jsonResponse.message + "</h2>");
		                    $("#dialogInfo").show(400);
							$(':input', '#userForm').not(':button').val('');
							logged = true;
							checkUserStatus();
						},
						error: function(errorMessage){
							$("#infoMessage").html("<h2>Could not login!</h2>");
		                    $("#dialogInfo").show(400);
						}
	                });
	            });
			});
		</script>
	</body>
	<!--Footer-->
	<footer class="page-footer black">
		<div class="footer-copyright">
			<div class="container">
				Â© 2017 START. All rights reserved
				<a class="grey-text text-lighten-4 right" href="#!">More Links</a>
			</div>
		</div>
	</footer>
</html>
